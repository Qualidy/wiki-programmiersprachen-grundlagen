# JavaScript Grundlagen 3 – DOM-Manipulation & Events

!!! abstract "Lernziele"
    Nach diesem Kapitel kannst du …

    - Das **Document Object Model (DOM)** verstehen und nutzen.
    - **HTML-Elemente** mit JavaScript auswählen und ändern.
    - **Events** (Klicks, Tastatureingaben) verarbeiten.
    - **Event Listener** korrekt implementieren.
    - **Dynamische Inhalte** erstellen und einfügen.

---

## Einführung

Das **DOM (Document Object Model)** ist eine Baumstruktur, die das HTML-Dokument repräsentiert. JavaScript kann das DOM lesen und verändern, um interaktive Webseiten zu erstellen.

![DOM Baum](https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/JavaScript_logo.png/300px-JavaScript_logo.png){ align=left width=300px }

**Wichtige Fakten:**
- DOM ist eine **Baumstruktur** (Nodes)
- Jedes HTML-Element ist ein **Node**
- JavaScript kann **Elemente finden, ändern, erstellen, löschen**
- **Events** ermöglichen Benutzerinteraktion

---

## DOM-Struktur

### Beispiel-HTML
```html
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Beispiel</title>
</head>
<body>
    <header id="header">
        <h1 class="titel">Willkommen</h1>
    </header>
    <main>
        <p id="text">Das ist ein Absatz.</p>
        <ul>
            <li class="item">Item 1</li>
            <li class="item">Item 2</li>
        </ul>
    </main>
</body>
</html>
```

### DOM-Baum
```
Document
├── html
│   ├── head
│   │   ├── meta
│   │   └── title
│   └── body
│       ├── header (#header)
│       │   └── h1 (.titel)
│       └── main
│           ├── p (#text)
│           └── ul
│               ├── li (.item)
│               └── li (.item)
```

---

## Elemente auswählen

### 1. Durch ID
```javascript
const header = document.getElementById('header');
const text = document.getElementById('text');
```

### 2. Durch Klasse
```javascript
const titel = document.querySelector('.titel');
const items = document.querySelectorAll('.item');

// items ist eine NodeList (ähnlich Array)
items.forEach(item => {
  console.log(item.textContent);
});
```

### 3. Durch Tag-Name
```javascript
const paragraphs = document.getElementsByTagName('p');
const allDivs = document.querySelectorAll('div');
```

### 4. Komplexe Selektoren
```javascript
// CSS-Selektoren
const firstItem = document.querySelector('ul li:first-child');
const activeItems = document.querySelectorAll('.item.active');

// Attribute
const links = document.querySelectorAll('a[href]');
```

### 5. Parent & Children
```javascript
const ul = document.querySelector('ul');
const children = ul.children; // HTMLCollection
const firstChild = ul.firstElementChild;
const lastChild = ul.lastElementChild;
const parent = ul.parentElement;
```

{{ task(file="tasks/02_00_08.yaml") }}

---

## Elemente ändern

### Text-Inhalt
```javascript
const text = document.getElementById('text');

// Nur Text (keine HTML-Tags)
text.textContent = 'Neuer Text';

// Mit HTML-Tags (Vorsicht vor XSS!)
text.innerHTML = '<strong>Fett</strong> und <em>kursiv</em>';

// Nur für Formulare
text.value = 'Eingabe';
```

### Attribute
```javascript
const link = document.querySelector('a');

// Attribut setzen
link.href = 'https://example.com';
link.target = '_blank';
link.title = 'Zur Beispielseite';

// Attribut lesen
const href = link.getAttribute('href');

// Attribut löschen
link.removeAttribute('target');
```

### Klassen
```javascript
const element = document.querySelector('.titel');

// Klasse hinzufügen
element.classList.add('active', 'highlight');

// Klasse entfernen
element.classList.remove('titel');

// Klasse umschalten (toggle)
element.classList.toggle('dark-mode');

// Prüfen, ob Klasse existiert
if (element.classList.contains('active')) {
  console.log('Element ist aktiv');
}
```

### Style
```javascript
const box = document.querySelector('#header');

// Inline-Style setzen
box.style.backgroundColor = 'blue';
box.style.padding = '20px';
box.style.fontSize = '24px';

// Mehrere Styles auf einmal
Object.assign(box.style, {
  backgroundColor: 'red',
  padding: '10px',
  borderRadius: '5px'
});

// Style lesen
const farbe = box.style.backgroundColor;
```

### Erstellen & Einfügen
```javascript
// Neues Element erstellen
const neuerParagraph = document.createElement('p');
neuerParagraph.textContent = 'Neuer Absatz';
neuerParagraph.className = 'neu';

// Einfügen
const main = document.querySelector('main');
main.appendChild(neuerParagraph); // Am Ende
main.insertBefore(neuerParagraph, main.firstChild); // Am Anfang

// Ersetzen
const alterText = document.getElementById('text');
main.replaceChild(neuerParagraph, alterText);

// Löschen
neuerParagraph.remove();
// Oder:
main.removeChild(neuerParagraph);
```

---

## Events

### Was sind Events?
Events sind **Benutzeraktionen** oder **Systemereignisse**, die im Browser passieren:
- **Klick** auf ein Element
- **Tastatureingabe** in ein Feld
- **Mausbewegung**
- **Seite geladen**
- **Fenster verändert**

### Event Listener (Modern)
```javascript
const button = document.querySelector('button');

// addEventListener (empfohlen)
button.addEventListener('click', function(event) {
  console.log('Button geklickt!');
  console.log(event); // Event-Objekt
});

// Arrow Function
button.addEventListener('click', (event) => {
  console.log('Klick!');
});
```

### Event-Objekt
```javascript
button.addEventListener('click', function(event) {
  // Event-Informationen
  console.log(event.type); // "click"
  console.log(event.target); // Das geklickte Element
  console.log(event.currentTarget); // Das Element mit Listener
  console.log(event.clientX, event.clientY); // Mausposition
});
```

### Verschiedene Events
```javascript
const input = document.querySelector('input');
const div = document.querySelector('div');

// Klick
button.addEventListener('click', () => {
  console.log('Geklickt!');
});

// Doppelklick
button.addEventListener('dblclick', () => {
  console.log('Doppelklick!');
});

// Mouseover / Mouseout
div.addEventListener('mouseover', () => {
  div.style.backgroundColor = 'lightblue';
});

div.addEventListener('mouseout', () => {
  div.style.backgroundColor = '';
});

// Tastatureingabe
input.addEventListener('keydown', (event) => {
  console.log('Taste gedrückt:', event.key);
});

// Input (bei jeder Änderung)
input.addEventListener('input', (event) => {
  console.log('Wert geändert:', event.target.value);
});

// Formular-Submit
const form = document.querySelector('form');
form.addEventListener('submit', (event) => {
  event.preventDefault(); // Verhindert Seiten-Neuladen
  console.log('Formular gesendet!');
});
```

### Event-Delegation
```javascript
// Besser: Ein Listener für alle Items
const ul = document.querySelector('ul');

ul.addEventListener('click', function(event) {
  // Prüfen, ob auf ein LI geklickt wurde
  if (event.target.tagName === 'LI') {
    console.log('Item geklickt:', event.target.textContent);
    event.target.classList.toggle('selected');
  }
});
```

### Event-Listener entfernen
```javascript
function handleClick() {
  console.log('Klick!');
}

// Hinzufügen
button.addEventListener('click', handleClick);

// Entfernen
button.removeEventListener('click', handleClick);
```

{{ task(file="tasks/02_00_09.yaml") }}

---

## Praktische Beispiele

### Beispiel 1: Dark Mode Toggle
```javascript
const toggleButton = document.querySelector('#dark-toggle');
const body = document.body;

toggleButton.addEventListener('click', () => {
  body.classList.toggle('dark-mode');

  // Text ändern
  if (body.classList.contains('dark-mode')) {
    toggleButton.textContent = 'Light Mode';
  } else {
    toggleButton.textContent = 'Dark Mode';
  }
});
```

### Beispiel 2: To-Do Liste
```javascript
const input = document.querySelector('#todo-input');
const button = document.querySelector('#add-todo');
const list = document.querySelector('#todo-list');

button.addEventListener('click', () => {
  const text = input.value.trim();

  if (text) {
    const li = document.createElement('li');
    li.textContent = text;

    // Löschen-Button
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'X';
    deleteBtn.addEventListener('click', () => {
      li.remove();
    });

    li.appendChild(deleteBtn);
    list.appendChild(li);
    input.value = '';
  }
});

// Enter-Taste
input.addEventListener('keydown', (event) => {
  if (event.key === 'Enter') {
    button.click();
  }
});
```

### Beispiel 3: Formular-Validierung
```javascript
const form = document.querySelector('#signup-form');
const emailInput = document.querySelector('#email');
const errorDiv = document.querySelector('#error');

form.addEventListener('submit', (event) => {
  event.preventDefault();

  const email = emailInput.value;

  if (!email.includes('@')) {
    errorDiv.textContent = 'Bitte gültige E-Mail eingeben';
    errorDiv.style.display = 'block';
    emailInput.style.borderColor = 'red';
  } else {
    errorDiv.style.display = 'none';
    emailInput.style.borderColor = 'green';
    console.log('Formular gültig!');
    // form.submit(); // Oder AJAX
  }
});
```

---

## Häufige Fehler & Best Practices

### Fehler 1: Event-Listener mehrfach hinzufügen
```javascript
// ❌ Falsch (Listener wird jedes Mal hinzugefügt)
button.addEventListener('click', () => { /* ... */ });
button.addEventListener('click', () => { /* ... */ });

// ✅ Gut (entferne alten Listener zuerst)
button.removeEventListener('click', alterHandler);
button.addEventListener('click', neuerHandler);
```

### Fehler 2: Event-Delegation vergessen
```javascript
// ❌ Schlecht (viele Listener)
document.querySelectorAll('.item').forEach(item => {
  item.addEventListener('click', handler);
});

// ✅ Gut (ein Listener)
document.querySelector('.container').addEventListener('click', (event) => {
  if (event.target.classList.contains('item')) {
    handler(event);
  }
});
```

### Fehler 3: Formular ohne preventDefault
```javascript
// ❌ Falsch (Seite wird neu geladen)
form.addEventListener('submit', () => {
  // Logik...
});

// ✅ Gut
form.addEventListener('submit', (event) => {
  event.preventDefault();
  // Logik...
});
```

### Best Practices
1. **Event-Delegation** für Listen verwenden
2. **Arrow Functions** für kurze Handler
3. **removeEventListener** für temporäre Handler
4. **preventDefault** bei Formularen
5. **Event-Objekt** nutzen für Informationen
6. **Klare Namenskonventionen** für Handler-Funktionen

---

## Zusammenfassung & Checkliste

### Wichtige Konzepte
- ✅ **DOM**: Baumstruktur des HTML-Dokuments
- ✅ **Auswahl**: getElementById, querySelector, querySelectorAll
- ✅ **Ändern**: textContent, innerHTML, style, classList
- ✅ **Erstellen**: createElement, appendChild, remove
- ✅ **Events**: addEventListener, Event-Objekt
- ✅ **Event-Delegation**: Ein Listener für viele Elemente

### Checkliste für Code
- [ ] querySelector/querySelectorAll bevorzugen
- [ ] Event-Delegation für Listen verwenden
- [ ] preventDefault bei Formularen
- [ ] removeEventListener für temporäre Handler
- [ ] Event-Objekt für Informationen nutzen
- [ ] Keine Inline-Event-Handler (onclick)

---

## Nächste Schritte

Nachdem du diese Grundlagen beherrschst:
1. **Async Programming** - Promises, Async/Await
2. **Fetch API** - Daten von Server laden
3. **LocalStorage** - Daten im Browser speichern
4. **Modularisierung** - ES6 Modules

**Empfohlene Ressourcen:**
- [MDN Web Docs - DOM](https://developer.mozilla.org/de/docs/Web/API/Document_Object_Model)
- [MDN Web Docs - Events](https://developer.mozilla.org/de/docs/Web/Events)
- [JavaScript.info - DOM](https://javascript.info/document)
