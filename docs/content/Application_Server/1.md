# Application Server 1 – Einführung & Grundlagen

!!! abstract "Lernziele"
    Nach diesem Kapitel kannst du …

    - Was ein **Application Server** ist und wofür er verwendet wird.
    - Die **Funktionen** eines Application Servers verstehen.
    - **Apache Tomcat** als Beispiel-Server kennenlernen.
    - Eine einfache **Webanwendung** deployen.
    - Die **Architektur** von Webanwendungen verstehen.

---

## Einführung

Ein **Application Server** ist eine Software, die als Plattform für die Ausführung von **Anwendungen** dient. Im Web-Kontext sind das typischerweise **Webanwendungen**, die über HTTP/HTTPS kommunizieren.

![Server Logo](https://upload.wikimedia.org/wikipedia/commons/thumb/f/fe/Apache_Tomcat_logo.svg/640px-Apache_Tomcat_logo.svg.png){ align=left width=300px }

**Wichtige Fakten:**
- Application Server sind **Middleware** zwischen Betriebssystem und Anwendung
- Sie bieten **Dienste** wie Sicherheit, Transaktionen, Datenbankzugriff
- Sie können **mehrere Anwendungen** gleichzeitig hosten
- Sie sind **plattformunabhängig** (Java-basiert)

**Anwendungsbereiche:**
- Enterprise-Anwendungen (Banking, Versicherungen)
- Webanwendungen (E-Commerce, Portale)
- REST-Services (APIs)
- Microservices-Architekturen

---

## Was ist ein Application Server?

### Definition
Ein Application Server ist eine **Laufzeitumgebung** für Softwareanwendungen, die:
- **Ressourcen** verwaltet (Speicher, Threads, Verbindungen)
- **Dienste** bereitstellt (Sicherheit, Transaktionen, Persistenz)
- **Skalierbarkeit** ermöglicht (Load Balancing, Clustering)
- **Monitoring** und Management bietet

### Unterschiede zu Web Server

| Aspekt | Web Server | Application Server |
|--------|------------|-------------------|
| **Zweck** | Statische Inhalte (HTML, CSS, Bilder) | Dynamische Inhalte (Java, PHP, .NET) |
| **Beispiele** | Apache, Nginx, IIS | Tomcat, JBoss, WebLogic, GlassFish |
| **Sprachen** | HTML, CSS, JavaScript | Java, Python, PHP, C# |
| **Datenbank** | Kein direkter Zugriff | Direkter Datenbankzugriff |
| **Skalierung** | Einfach | Komplexer |

### Kombination: Web Server + Application Server
```
Browser → Web Server (Apache/Nginx) → Application Server (Tomcat) → Anwendung
```

---

## Kernfunktionen eines Application Servers

### 1. Lifecycle Management
- Starten, Stoppen, Neustarten von Anwendungen
- Automatisches Laden bei Server-Start
- Hot-Deployment (Anwendungen ohne Neustart aktualisieren)

### 2. Ressourcen-Management
- **Thread-Pooling**: Verwaltung von Arbeits-Threads
- **Connection-Pooling**: Verwaltung von Datenbank-Verbindungen
- **Speichermanagement**: Garbage Collection optimieren

### 3. Sicherheit
- **Authentication**: Benutzerauthentifizierung
- **Authorization**: Berechtigungsverwaltung (Rollen)
- **SSL/TLS**: Verschlüsselung der Kommunikation
- **Session-Management**: Sichere Session-Verwaltung

### 4. Transaktionsmanagement
- **ACID-Prinzipien** (Atomicity, Consistency, Isolation, Durability)
- **Distributed Transactions** über mehrere Ressourcen
- **Rollback** bei Fehlern

### 5. Datenbankzugriff
- **JDBC** (Java Database Connectivity)
- **Connection-Pooling** für Performance
- **ORM-Integration** (Hibernate, JPA)

### 6. Web-Services
- **REST-APIs** (JAX-RS)
- **SOAP-Services** (JAX-WS)
- **JSON/XML-Verarbeitung**

### 7. Monitoring & Management
- **JMX** (Java Management Extensions)
- **Logging** und Tracing
- **Performance-Metriken**
- **Admin-Konsole**

---

## Apache Tomcat

### Was ist Tomcat?
**Apache Tomcat** (auch bekannt als **Jakarta Tomcat**) ist der **populärste Open-Source Application Server** für Java Webanwendungen.

**Wichtige Fakten:**
- Entwickelt von Apache Software Foundation
- Implementiert **Jakarta Servlet**, **Jakarta Server Pages (JSP)**, **Jakarta WebSocket**
- **Kein vollständiger Java EE/Jakarta EE Server** (nur Web-Container)
- Leichtgewichtig und einfach zu konfigurieren
- Kostenlos und Open-Source

**Versionen:**
- **Tomcat 10.x** (aktuell, Jakarta EE 9/10)
- **Tomcat 9.x** (Java EE 8)
- **Tomcat 8.x** (Java EE 7)

### Architektur
```
Client (Browser) → Connector (HTTP) → Container (Servlet Engine)
                                      ↓
                              → Servlets / JSP
                                      ↓
                              → Datenbank / externe Ressourcen
```

**Komponenten:**
- **Connector**: Empfängt HTTP-Anfragen (HTTP/1.1, HTTP/2, AJP)
- **Container**: Verarbeitet Anfragen (Servlet Engine)
- **Servlet**: Java-Klasse, die HTTP-Anfragen verarbeitet
- **JSP**: Java Server Pages (HTML mit Java-Code)

---

## Installation & Setup

### Schritt 1: Download
Lade Tomcat von [tomcat.apache.org](https://tomcat.apache.org/) herunter:
- Wähle die aktuelle Version (z. B. Tomcat 10.1.x)
- Wähle "Core" (ZIP-Datei)

### Schritt 2: Entpacken
Entpacke die ZIP-Datei in ein Verzeichnis, z. B.:
```
C:\Programme\apache-tomcat-10.1.x\
```

### Schritt 3: Verzeichnisstruktur
```
apache-tomcat-10.1.x/
├── bin/           # Start/Stop-Skripte
├── conf/          # Konfigurationsdateien
├── lib/           # Bibliotheken
├── logs/          # Log-Dateien
├── temp/          # Temporäre Dateien
├── webapps/       # Anwendungen werden hier deployed
└── work/          # Kompilierte JSPs
```

### Schritt 4: Starten
**Windows:**
```bash
bin\startup.bat
```

**Linux/Mac:**
```bash
./bin/startup.sh
```

### Schritt 5: Prüfen
Öffne den Browser und gehe zu:
```
http://localhost:8080
```

Du solltest die **Tomcat-Startseite** sehen.

### Schritt 6: Stoppen
**Windows:**
```bash
bin\shutdown.bat
```

**Linux/Mac:**
```bash
./bin/shutdown.sh
```

---

## Konfiguration

### Server-Port ändern
Datei: `conf/server.xml`

```xml
<Connector port="8080" protocol="HTTP/1.1"
           connectionTimeout="20000"
           redirectPort="8443" />
```

**Ändern zu:**
```xml
<Connector port="8081" protocol="HTTP/1.1" ... />
```

### Admin-Berechtigungen
Datei: `conf/tomcat-users.xml`

```xml
<role rolename="manager-gui"/>
<role rolename="admin-gui"/>
<user username="admin" password="admin123" roles="manager-gui,admin-gui"/>
```

### Context-Path
In `conf/server.xml` oder `conf/Catalina/localhost/`:
```xml
<Context path="/meine-app" docBase="meine-app" />
```

---

## Deployment

### 1. Manuelles Deployment (einfach)
Kopiere die **WAR-Datei** (Web Application Archive) in das `webapps`-Verzeichnis:

```bash
cp meine-app.war /opt/tomcat/webapps/
```

Tomcat entpackt automatisch und startet die Anwendung.

### 2. Manager-Interface
Öffne: `http://localhost:8080/manager`

- **Deploy**: Neue Anwendung hochladen
- **Undeploy**: Anwendung entfernen
- **Start/Stop**: Anwendung starten/stoppen
- **Reload**: Anwendung neu laden

### 3. Auto-Deployment
In `conf/server.xml`:
```xml
<Host name="localhost" appBase="webapps"
      unpackWARs="true" autoDeploy="true">
</Host>
```

---

## Erste Webanwendung

### Projektstruktur
```
meine-app/
├── src/
│   └── main/
│       ├── java/
│       │   └── com/
│       │       └── example/
│       │           └── HelloServlet.java
│       └── webapp/
│           ├── WEB-INF/
│           │   └── web.xml
│           └── index.jsp
├── pom.xml (Maven)
```

### HelloServlet.java
```java
package com.example;

import java.io.*;
import jakarta.servlet.*;
import jakarta.servlet.http.*;

public class HelloServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request,
                        HttpServletResponse response)
            throws ServletException, IOException {

        response.setContentType("text/html");
        PrintWriter out = response.getWriter();

        out.println("<html><body>");
        out.println("<h1>Hallo von Servlet!</h1>");
        out.println("<p>Zeit: " + new java.util.Date() + "</p>");
        out.println("</body></html>");
    }
}
```

### web.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee
                             https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"
         version="5.0">

    <servlet>
        <servlet-name>HelloServlet</servlet-name>
        <servlet-class>com.example.HelloServlet</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>HelloServlet</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>

    <welcome-file-list>
        <welcome-file>index.jsp</welcome-file>
    </welcome-file-list>
</web-app>
```

### index.jsp
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Meine erste Webanwendung</title>
</head>
<body>
    <h1>Willkommen!</h1>
    <p>Dies ist eine JSP-Seite.</p>
    <a href="hello">Zum Servlet</a>
</body>
</html>
```

### Maven-Build (pom.xml)
```xml
<project>
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>meine-app</artifactId>
    <version>1.0</version>
    <packaging>war</packaging>

    <dependencies>
        <dependency>
            <groupId>jakarta.servlet</groupId>
            <artifactId>jakarta.servlet-api</artifactId>
            <version>5.0.0</version>
            <scope>provided</scope>
        </dependency>
    </dependencies>

    <build>
        <finalName>meine-app</finalName>
    </build>
</project>
```

**Build:**
```bash
mvn clean package
```

**Deploy:**
```bash
cp target/meine-app.war /opt/tomcat/webapps/
```

**Aufrufen:**
- JSP: `http://localhost:8080/meine-app/`
- Servlet: `http://localhost:8080/meine-app/hello`

---

## Praktische Beispiele

### Beispiel 1: Formular verarbeiten
```java
// FormServlet.java
public class FormServlet extends HttpServlet {
    @Override
    protected void doPost(HttpServletRequest request,
                         HttpServletResponse response)
            throws ServletException, IOException {

        String name = request.getParameter("name");
        String email = request.getParameter("email");

        response.setContentType("text/html");
        PrintWriter out = response.getWriter();

        out.println("<html><body>");
        out.println("<h1>Daten erhalten</h1>");
        out.println("<p>Name: " + name + "</p>");
        out.println("<p>Email: " + email + "</p>");
        out.println("</body></html>");
    }
}
```

### Beispiel 2: Session-Management
```java
// SessionServlet.java
public class SessionServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request,
                        HttpServletResponse response)
            throws ServletException, IOException {

        HttpSession session = request.getSession();

        // Session-Daten setzen
        session.setAttribute("benutzer", "Max");
        session.setAttribute("rolle", "Admin");

        // Session-ID ausgeben
        String sessionId = session.getId();

        response.setContentType("text/html");
        PrintWriter out = response.getWriter();

        out.println("<html><body>");
        out.println("<h1>Session erstellt</h1>");
        out.println("<p>Session-ID: " + sessionId + "</p>");
        out.println("</body></html>");
    }
}
```

### Beispiel 3: Datenbank-Zugriff (JDBC)
```java
// DatabaseServlet.java
public class DatabaseServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request,
                        HttpServletResponse response)
            throws ServletException, IOException {

        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/mydb",
                "user",
                "password"
            );

            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT * FROM users");

            response.setContentType("text/html");
            PrintWriter out = response.getWriter();

            out.println("<html><body>");
            out.println("<h1>Benutzerliste</h1>");
            out.println("<table border='1'>");
            out.println("<tr><th>ID</th><th>Name</th></tr>");

            while (rs.next()) {
                out.println("<tr>");
                out.println("<td>" + rs.getInt("id") + "</td>");
                out.println("<td>" + rs.getString("name") + "</td>");
                out.println("</tr>");
            }

            out.println("</table>");
            out.println("</body></html>");

            rs.close();
            stmt.close();
            conn.close();

        } catch (Exception e) {
            throw new ServletException(e);
        }
    }
}
```

---

## Häufige Fehler & Best Practices

### Fehler 1: Port bereits belegt
```
Port 8080 required by Tomcat is already in use
```
**Lösung:** Ändere den Port in `conf/server.xml` oder beende den Prozess.

### Fehler 2: ClassNotFoundException
```
java.lang.ClassNotFoundException: com.example.HelloServlet
```
**Lösung:** Prüfe den Classpath und die `web.xml`-Konfiguration.

### Fehler 3: 404 Not Found
```
HTTP Status 404 – Not Found
```
**Lösung:** Prüfe den Context-Path und die URL-Mapping.

### Fehler 4: OutOfMemoryError
```
java.lang.OutOfMemoryError: Java heap space
```
**Lösung:** Erhöhe den Heap-Speicher in `bin/setenv.sh`/`setenv.bat`:
```bash
JAVA_OPTS="-Xmx1024m -Xms512m"
```

### Best Practices
1. **Context-Path**: Kurz und aussagekräftig (`/shop`, `/api`)
2. **Session-Timeout**: Nicht zu lange (Standard: 30 Minuten)
3. **Logging**: Konfiguriere Logging (Log4j, SLF4J)
4. **Sicherheit**: HTTPS aktivieren, Passwörter verschlüsseln
5. **Performance**: Connection-Pooling verwenden
6. **Monitoring**: JMX und Health-Checks einrichten

---

## Zusammenfassung & Checkliste

### Wichtige Konzepte
- ✅ **Application Server**: Plattform für Anwendungen
- ✅ **Tomcat**: Populärer Java Web-Container
- ✅ **Deployment**: WAR-Dateien, Manager-Interface
- ✅ **Servlets & JSP**: Dynamische Webinhalte
- ✅ **Session-Management**: Benutzer-Session verwalten
- ✅ **Sicherheit**: Authentifizierung, Autorisierung

### Checkliste für Setup
- [ ] Tomcat installiert und gestartet
- [ ] Port 8080 erreichbar
- [ ] Admin-Berechtigungen konfiguriert
- [ ] Erste Webanwendung deployed
- [ ] Logging konfiguriert
- [ ] Sicherheitseinstellungen geprüft

---

## Nächste Schritte

Nachdem du diese Grundlagen beherrschst:
1. **Tomcat-Konfiguration** - Server.xml, Context.xml, Web.xml
2. **Advanced Deployment** - Docker, Kubernetes
3. **Performance-Tuning** - Connection-Pooling, Caching
4. **Monitoring** - JMX, Prometheus, Grafana
5. **Clustering** - Load Balancing, Session Replication

**Empfohlene Ressourcen:**
- [Apache Tomcat Documentation](https://tomcat.apache.org/tomcat-10.1-doc/)
- [Jakarta EE Tutorial](https://eclipse-ee4j.github.io/jakartaee-tutorial/)
- [Baeldung Tomcat](https://www.baeldung.com/tomcat)
